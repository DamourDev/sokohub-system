{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>My Products</h2>
        <button type="button" class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addProductModal">
            Add New Product
        </button>
    </div>

    {% comment %} {% if products %}
        <div class="row">
            {% for product in products %}
                <div class="col-md-4 mb-4">
                    <div class="card h-100 shadow-sm">
                        {% if product.image %}
                            <img src="{{ product.image.url }}" class="card-img-top" style="width:100%; height:200px; object-fit:contain; background-color:#f8f9fa; padding:5px; border-radius:6px;" alt="{{ product.name }}">

                        {% else %}
                            <img src="{% static 'images/placeholder.png' %}" class="card-img-top" style="height:200px; object-fit:cover;" alt="No image">
                        {% endif %}

                        <div class="card-body">
                            <h5 class="card-title">{{ product.name }}</h5>
                            <p class="card-text">
                                Price: {{ product.price }} Frw <br>
                                Stock: 
                                {% if product.stock > 0 %}
                                    {{ product.stock }}
                                {% else %}
                                    <span class="text-danger">Out of Stock</span>
                                {% endif %}
                                <br>
                                Status: {{ product.status|capfirst }}
                            </p>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info">
            You have no products yet. <a href="{% url 'add_product' %}">Add your first product</a>.
        </div>
    {% endif %} {% endcomment %}
    <div class="row rounded-4">
            {% for product in products %}
                <div class="col-sm-6 col-md-4 col-lg-3 mb-3">
                    <div class="card h-100 shadow-sm">
                        {% if product.image %}
                            <img src="{{ product.image.url }}" class="card-img-top " style=" width:100%; height:200px; object-fit:cover; border-radius-6 ;" alt="{{ product.name }}">
                        {% else %}
                            <img src="{% static 'images/placeholder.png' %}" class="card-img-top" style="width-100%; height:200px; object-fit:cover; border-radius-6;" alt="No image">
                        {% endif %}
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">{{ product.name }}</h5>
                            <p class="card-text fw-bold text-success">{{ product.price }} Frw</p>
                            <p class="card-text text-muted fw-semibold">Status: {{ product.status|capfirst }}</p>
                            {% if product.stock > 0 %}
                                <span class="badge bg-success mb-2">In Stock: {{ product.stock }}</span>
                            {% else %}
                                <span class="badge bg-danger mb-2">Out of Stock</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% empty %}
                <p>No products available at the moment.</p>
            {% endfor %}
        </div>

    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg mx-3 mt-5">
        <div class="modal-content">
        <div class="modal-header bg-success text-white">
            <h5 class="modal-title" id="addProductModalLabel">Add New Product</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <form method="POST" action="{% url 'add_product' %}" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.non_field_errors }}

                <!-- Name and Price in one row -->
                <div class="row mb-3">
                    <div class="col-md-6 mb-2">
                        {{ form.name.label_tag }}
                        {{ form.name }}
                        {% if form.name.errors %}<div class="text-danger">{{ form.name.errors }}</div>{% endif %}
                    </div>
                    <div class="col-md-6 mb-2">
                        {{ form.price.label_tag }}
                        {{ form.price }}
                        {% if form.price.errors %}<div class="text-danger">{{ form.price.errors }}</div>{% endif %}
                    </div>
                </div>

                <!-- Stock and Image in one row -->
                <div class="row mb-3">
                    <div class="col-md-6 mb-2">
                        {{ form.stock.label_tag }}
                        {{ form.stock }}
                        {% if form.stock.errors %}<div class="text-danger">{{ form.stock.errors }}</div>{% endif %}
                    </div>
                    <div class="col-md-6 mb-2">
                        {{ form.image.label_tag }}
                        {{ form.image }}
                        {% if form.image.errors %}<div class="text-danger">{{ form.image.errors }}</div>{% endif %}
                    </div>
                </div>

                <!-- Description full width -->
                <div class="mb-3">
                    {{ form.description.label_tag }}
                    {{ form.description }}
                    {% if form.description.errors %}<div class="text-danger">{{ form.description.errors }}</div>{% endif %}
                </div>

                <!-- Buttons -->
                <div class="d-flex justify-content-end gap-2">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Product</button>
                </div>
    </div>
{% endblock content %}
